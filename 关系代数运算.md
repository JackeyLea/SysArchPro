## 环境

- sqlite 3.46.1

不同数据库、不同版本可能会有顺序上的差异，支持的关系运算符号也可能不同。

## 测试数据 

### 表R

| A | B | C |
| - | - | - |
| $a_1$ | $b_1$ | $c_1$
| $a_1$ | $b_2$ | $c_2$
| $a_2$ | $b_2$ | $c_1$

### 表S

| A | B | C |
| - | - | - |
| $a_1$ | $b_2$ | $c_2$
| $a_1$ | $b_3$ | $c_2$
| $a_2$ | $b_2$ | $c_1$

建立R/S两个表，表中内容和示例一样。

## 1.传统的集合运算

### 1.1.交/$\cap$/Intersection

R $\cap$ S表示取两个集合中重复部分

| A | B | C |
| - | - | - |
| $a_1$ | $b_2$ | $c_2$
| $a_2$ | $b_2$ | $c_1$

对应SQL语句

```sql
select * from R
intersect
select * from S;
```

### 1.2.并/$\cup$/Union

R $\cup$ S表示取两个合集中所有部分且去重。

| A | B | C |
| - | - | - |
| $a_1$ | $b_1$ | $c_1$
| $a_1$ | $b_2$ | $c_2$
| $a_2$ | $b_2$ | $c_1$
| $a_1$ | $b_3$ | $c_2$

对应SQL语句

```sql
select * from R
union
select * from S;
```

### 1.3.差/-/Difference

R-S表示R中有而S中没有的

| A | B | C |
| - | - | - |
| $a_1$ | $b_1$ | $c_1$

对应SQL语句

```sql
select * from R
except
select * from S;
```

### 1.4.笛卡尔积/$\times$/Cartesian Product

R $\times$ S集合R与集合S的每个元组进行连接。

| R.A | R.B | R.C | S.A | S.B | S.C
| - | - | - | - | - | - |
| $a_1$ | $b_1$ | $c_1$ | $a_1$ | $b_2$ | $c_2$ |
| $a_1$ | $b_1$ | $c_1$ | $a_1$ | $b_3$ | $c_2$ |
| $a_1$ | $b_1$ | $c_1$ | $a_2$ | $b_2$ | $c_1$ |
| $a_1$ | $b_2$ | $c_2$ | $a_1$ | $b_2$ | $c_2$ |
| $a_1$ | $b_2$ | $c_2$ | $a_1$ | $b_3$ | $c_2$ |
| $a_1$ | $b_2$ | $c_2$ | $a_2$ | $b_2$ | $c_1$ |
| $a_2$ | $b_2$ | $c_1$ | $a_1$ | $b_2$ | $c_2$ |
| $a_2$ | $b_2$ | $c_1$ | $a_1$ | $b_3$ | $c_2$ |
| $a_2$ | $b_2$ | $c_1$ | $a_2$ | $b_2$ | $c_1$ |

数据的操作

```sql
select * from R,S;
```

## 2.专门的关系运算

### 2.1.选择/$\sigma$/Selection

选择就是对表在水平方向上，筛选出一定符合条件的元组，然后组成新的关系

$\sigma_{A="a1" \bigwedge B="b1"}(R)$表示从R中选择A为$a_1$且B为$b_1$的元组

| A | B | C |
| - | - | - |
| $a_1$ | $b_1$ | $c_1$

数据库操作

```sql
select * from R where A='a1' and B='b1';
```

$\bigwedge$表示且，$\bigvee$表示或

### 2.2.投影/$\Pi$/Projection

**大写的$\pi$**

投影就是对表在垂直方向上，对列进行筛选。

$\Pi_{A,C}(R)$表示从R中对A和C列进行投影，如果投影中有重复元组就去掉。

| A | C |
| - | - |
| $a_1$ | $c_1$
| $a_1$ | $c_2$
| $a_2$ | $c_1$

对应SQL语句

```sql
select A,C from R;
```

### 2.3.连接/$\theta$/Join

连接就是根据给定的条件，从两个已知的关系R和S的笛卡尔集中，选取满足连接条件的若干元组，组成一个新的关系。

$R \mathop{\bowtie}\limits_{A \theta B} S$

#### 2.3.1.内连接

这个比较复杂，需要新的表。

R

| A | B | C
| - | - | - |
| $a_1$ | $b_1$ | 5
| $a_1$ | $b_2$ | 6
| $a_2$ | $b_3$ | 8
| $a_2$ | $b_4$ | 12

S

| B | E |
| - | - |
| $b_1$ | 3
| $b_2$ | 7
| $b_3$ | 10
| $b_3$ | 2
| $b_5$ | 2

R $\times$ S

| R.A | R.B | R.C | S.B | S.E
| - | - | - | - | - |
| $a_1$ | $b_1$ | 5 | $b_1$ | 3
| $a_1$ | $b_1$ | 5 | $b_2$ | 7
| $a_1$ | $b_1$ | 5 | $b_3$ | 10
| $a_1$ | $b_1$ | 5 | $b_3$ | 2
| $a_1$ | $b_1$ | 5 | $b_5$ | 2
| $a_1$ | $b_2$ | 6 | $b_1$ | 3
| $a_1$ | $b_2$ | 6 | $b_2$ | 7
| $a_1$ | $b_2$ | 6 | $b_3$ | 10
| $a_1$ | $b_2$ | 6 | $b_3$ | 2
| $a_1$ | $b_2$ | 6 | $b_5$ | 2
| $a_2$ | $b_3$ | 8 | $b_1$ | 3
| $a_2$ | $b_3$ | 8 | $b_2$ | 7
| $a_2$ | $b_3$ | 8 | $b_3$ | 10
| $a_2$ | $b_3$ | 8 | $b_3$ | 2
| $a_2$ | $b_3$ | 8 | $b_5$ | 2
| $a_2$ | $b_4$ | 12 | $b_1$ | 3
| $a_2$ | $b_4$ | 12 | $b_2$ | 7
| $a_2$ | $b_4$ | 12 | $b_3$ | 10
| $a_2$ | $b_4$ | 12 | $b_3$ | 2
| $a_2$ | $b_4$ | 12 | $b_5$ | 2

##### 2.3.1.1.条件连接

选取满足条件的元组组成的关系

$R \mathop{\bowtie}\limits_{C<E} S$

| R.A | R.B | R.C | S.B | S.E
| - | - | - | - | - |
| $a_1$ | $b_1$ | 5 | $b_2$ | 7
| $a_1$ | $b_1$ | 5 | $b_3$ | 10
| $a_1$ | $b_2$ | 6 | $b_2$ | 7
| $a_1$ | $b_2$ | 6 | $b_3$ | 10
| $a_2$ | $b_3$ | 8 | $b_3$ | 10

##### 2.3.1.2.等值连接

选取满足等值条件的元组组成新关系

$R \mathop{\bowtie}\limits_{R.B=S.B} S$

| R.A | R.B | R.C | S.B | S.E
| - | - | - | - | - |
| $a_1$ | $b_1$ | 5 | $b_1$ | 3
| $a_1$ | $b_2$ | 6 | $b_2$ | 7
| $a_2$ | $b_3$ | 8 | $b_3$ | 10
| $a_2$ | $b_3$ | 8 | $b_3$ | 2

##### 2.3.1.3.自然连接/Natural Join
($\bowtie$)

也是等值连接，只不过它是选取满足公共属性满足等值的元组，组成关系。

在本R/S示例中R.B=S.B且R.C=S.C，因为R/S公共属性列式B/C

$ R \bowtie S $

| A | B | C | E
| $a_1$ | $b_1$ | 5 | 3
| $a_1$ | $b_2$ | 6 | 7
| $a_2$ | $b_3$ | 8 | 10
| $a_2$ | $b_3$ | 8 | 2

#### 2.3.2.外连接/Oter Join/+

外连接就是将不满足条件舍弃的元组也保留到新关系中其属性值置为null

- 左外连接/Left Outer Join/$\ltimes$
- 右外连接/Right Outer Join/$\rtimes$
- 全外连接/Full Outer Join/

MySQL不支持全外连接。

#### 2.3.3.交叉连接

交叉连接就是笛卡尔积$\times$

### 2.4.除/$\div$/Divide

这个新生成的列表首先不能包含S的属性，然后这个新生成的表其所有属性值和S表组合都等在R中找到